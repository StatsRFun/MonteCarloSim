<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monte Carlo Profit Simulation</title>
  <style>
    #simulation-container {
      position: relative;
      width: 600px;
      height: 300px;
      border: 1px solid #000;
      margin-bottom: 20px;
    }

    .point {
      position: absolute;
      width: 5px;
      height: 5px;
      background-color: #000;
      border-radius: 50%;
    }

    #profit-histogram {
      width: 600px;
      height: 200px;
      border: 1px solid #000;
      overflow: hidden;
    }

    #profit-bars {
      display: flex;
      position: relative;
      height: 100%;
    }

    .bar {
      flex: 1;
      background-color: #999;
      margin: 0 1px;
    }
  </style>
</head>
<body>

  <h1>Monte Carlo Profit Simulation</h1>

  <div id="simulation-container"></div>

  <div id="profit-histogram">
    <div id="profit-bars"></div>
  </div>

  <script>
    const simulationContainer = document.getElementById('simulation-container');
    const profitHistogram = document.getElementById('profit-histogram');
    const profitBars = document.getElementById('profit-bars');

    let totalSimulations = 0;
    let totalProfit = 0;
    let totalProfitSquared = 0;
    const profitData = [];

    function updateProfitStats() {
      const meanProfit = totalProfit / totalSimulations;
      const stdDevProfit = Math.sqrt(totalProfitSquared / totalSimulations - meanProfit ** 2);

      const binCount = 20;
      const binWidth = (2 * stdDevProfit) / binCount;
      const bins = Array.from({ length: binCount }, (_, i) => i * binWidth + meanProfit - stdDevProfit);

      const binCounts = Array(binCount).fill(0);

      profitData.forEach(profit => {
        const binIndex = Math.floor((profit - (meanProfit - stdDevProfit)) / binWidth);
        binCounts[binIndex]++;
      });

      profitBars.innerHTML = '';
      bins.forEach((bin, index) => {
        const barHeight = (binCounts[index] / totalSimulations) * 100 + '%';
        const barElement = document.createElement('div');
        barElement.className = 'bar';
        barElement.style.height = barHeight;
        profitBars.appendChild(barElement);
      });
    }

    function performMonteCarloSimulation() {
      if (totalSimulations >= 1000) {
        clearInterval(simulationInterval);
        return;
      }

      const demand = gaussianRandom(1000, 300);
      const unitRevenue = uniformRandom(100, 150);
      const unitCost = triangularRandom(80, 90, 170);

      const quantitySold = Math.min(demand, Math.floor(Math.random() * demand) + 1);
      const revenue = quantitySold * unitRevenue;
      const cost = quantitySold * unitCost;
      const profit = revenue - cost;

      totalSimulations++;
      totalProfit += profit;
      totalProfitSquared += profit ** 2;
      profitData.push(profit);

      const pointElement = document.createElement('div');
      pointElement.className = 'point';
      pointElement.style.left = `${(quantitySold / 2000) * 100}%`;
      pointElement.style.top = `${((profit + 500) / 1000) * 100}%`;

      simulationContainer.appendChild(pointElement);

      updateProfitStats();
    }

    function gaussianRandom(mean, stdDev) {
      let u = 0;
      let v = 0;
      while (u === 0) u = Math.random();
      while (v === 0) v = Math.random();
      return mean + stdDev * Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
    }

    function uniformRandom(min, max) {
      return Math.random() * (max - min) + min;
    }

    function triangularRandom(min, mode, max) {
      const u = Math.random();
      return u < (mode - min) / (max - min)
        ? min + Math.sqrt(u * (max - min) * (mode - min))
        : max - Math.sqrt((1 - u) * (max - min) * (max - mode));
    }

    const simulationInterval = setInterval(performMonteCarloSimulation, 10);
  </script>

</body>
</html>
